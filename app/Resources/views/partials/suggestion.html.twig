<div class="modal fade in" id="addSuggestion" tabindex="-1" role="dialog"
     aria-labelledby="addSuggestionModalLabel" aria-hidden="true" style="padding-right: 17px;">
    <div class="modal-dialog modal-lg">
        <div class="modal-content ">
            <form id="formSuggestion" action="{{ path("addSuggestion") }}" method="post"
                  class="form-horizontal">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                                aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title text-center"
                        id="addSuggestionModalLabel">{{ "suggestion.modale.texte"|trans }}</h4>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label class="col-sm-2 col-sm-offset-1 control-label" for="titre">{{ "Titre"|trans }}
                            &nbsp;:</label>
                        <div class="col-sm-8 control-label">
                            <input type="text" class="form-control" id="titre" name="titre">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-2 col-sm-offset-1 control-label"
                               for="description">{{ "Description"|trans }}&nbsp;:</label>
                        <div class="col-sm-8 control-label">
                                    <textarea id="description" name="description" class="resize-vertical form-control"
                                              rows="10"></textarea>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-2 col-sm-offset-1 control-label"
                               for="nom">{{ "suggestion.modale.champ_nom"|trans }}&nbsp;:</label>
                        <div class="col-sm-8 control-label">
                            <input type="text" class="form-control" id="nom" name="nom"
                                   value="{{ is_granted("IS_AUTHENTICATED_REMEMBERED")?app.user.applicationUser.appUserInformation.publicName }}">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-2 col-sm-offset-1 control-label"
                               for="email">{{ "suggestion.modale.champ_email"|trans }}&nbsp;:</label>
                        <div class="col-sm-8 control-label">
                            <input type="text" class="form-control" id="mail" name="mail"
                                   value="{{ is_granted("IS_AUTHENTICATED_REMEMBERED")?app.user.email }}">
                        </div>
                    </div>
                    <input type="hidden" name="resolution" id="resolution">
                    <input type="hidden" name="os" id="os">
                    <input type="hidden" name="navigateur" id="navigateur">
                    <input type="hidden" name="userAgent" id="userAgent">
                    <input type="hidden" name="pageURL" id="pageURL">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn waves-effect"
                            data-dismiss="modal">{{ "Fermer"|trans }}</button>
                    <button id="envoyerSuggestionOuBug" type="submit" class="btn waves-effect btn-primary"
                            data-style="zoom-in"><span>{{ "Ajouter"|trans }}</span>
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    $('form#formSuggestion').on('submit', function (e) {
        var $form = $(this);
        ajaxFormSubmission(this, e, function (responseJSON, textStatus, jqXHR) {
                $form[0].reset();
            }
        );
    });
</script>

<!-- Base : Suggestion/Bugs-->
<script>
    // Formulaire de soumission de suggestions/bugs
    var formSuggestion = $('#formSuggestion');
    formSuggestion.on("submit", function (event) {
        event.preventDefault();
        datas = $(this).serializeArray();
        $.ajax("{{ path("addSuggestion") }}", {
            type: "POST",
            data: datas
        }).done(function (data) {
            document.querySelector("#formSuggestion").reset();
            toastr["info"](data['message'], data['titre']);
        }).fail(function (data) {
            toastr["error"](data['message'], data['titre']);
        }).then(function (data) {
            $('#addSuggestion').modal('toggle');
        });
    });

    $('#lienOuvreSuggestion').click(function () {
        // Resolution de l'Ã©cran
        formSuggestion.find('#resolution').val("Height: " + $(window).height() + ' ; Width: ' + $(window).width());

        // OS
        var OSName = "Unknown OS";
        if (navigator.appVersion.indexOf("Win") != -1) OSName = "Windows";
        if (navigator.appVersion.indexOf("Mac") != -1) OSName = "MacOS";
        if (navigator.appVersion.indexOf("X11") != -1) OSName = "UNIX";
        if (navigator.appVersion.indexOf("Linux") != -1) OSName = "Linux";
        formSuggestion.find('#os').val(OSName);

        // Navigateur
        formSuggestion.find('#navigateur').val(navigator.appName + " " + navigator.appVersion);

        // User Agent
        formSuggestion.find('#userAgent').val(navigator.userAgent);

        // Page ocurante
        formSuggestion.find('#pageURL').val(window.location.href);
    })
</script>