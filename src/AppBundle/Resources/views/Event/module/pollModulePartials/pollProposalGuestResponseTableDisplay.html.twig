{# Données d'entrée :
- module ([Module]) module
- moduleInvitations ([ModuleInvitation]) les invitations du module
#}

<div id="pollModuleDisplayAllResult_{{ module.token }}_container">
    <div class="modal fade in" id="pollModuleDisplayAllResult_{{ module.token }}_modal" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title">{{ "pollmodule.display.result.modal.title"|trans }}</h4>
                </div>
                <div class="modal-body poll-response">
                    <div class="table-responsive">
                        <table id="pollmodule-table-{{ module.token }}" class="table table-striped table-condensed">
                            <thead>
                            <tr>
                                <th class="pollproposal-column"></th>
                                {% for moduleInvitation in moduleInvitations %}
                                    {% if moduleInvitation.eventInvitation.status is not constant('AppBundle\\Utils\\enum\\EventInvitationStatus::CANCELLED')
                                    and moduleInvitation.eventInvitation.status is not constant('AppBundle\\Utils\\enum\\EventInvitationStatus::AWAITING_VALIDATION') %}
                                        <td class="response-column">
                                            <div class="center-content">
                                                <div class="avatar-img-container-sm center-block m-5">
                                                    {{ include("@App/Avatar/partials/avatar_display.html.twig",{invitation : moduleInvitation}) }}
                                                </div>
                                            </div>
                                        </td>
                                    {% endif %}
                                {% endfor %}
                            </tr>
                            </thead>
                            <tbody>
                            {% for pollProposal in module.pollModule.pollProposals if not pollProposal.deleted and pollProposal.id is not null %}
                                <tr>
                                    <td class="pollproposal-column">
                                        <span {% if pollProposal.description is not empty %}data-toggle="tooltip" data-container="body" title="{{ pollProposal.description }}"{% endif %}>
                                            {% for ppElt in pollProposal.pollProposalElements %}
                                                {% if ppElt.pollElement.type == constant('AppBundle\\Utils\\enum\\PollElementType::DATETIME') %}
                                                    {% set endDate = ppElt.pollProposal.getPollProposalEndDateElement %}
                                                    {% set has2Date = endDate is not null and endDate.hasEndDate and ppElt.value|localizeddate("medium", "none", null, null,'ddMMyyyy') != endDate.value|localizeddate("medium", "none", null, null,'ddMMyyyy') %}
                                                    <div>
                                                        {% if not has2Date %}
                                                            <div style="display:inline-block; vertical-align: middle;">
                                                                <div style="font-size:12px; font-weight: bold; text-transform: capitalize;">{{ ppElt.value|localizeddate("medium", "none", null, null,'MMM') }}</div>
                                                                <div style="font-size:10px; text-transform: uppercase;">{{ ppElt.value|localizeddate("medium", "none", null, null,"ccc") }}</div>
                                                            </div>
                                                            <div class="p-l-5 p-r-5" style="display:inline-block; font-size:22px; vertical-align: middle;">
                                                                <strong>{{ ppElt.value|localizeddate("medium", "none", null, null,'dd') }}</strong>
                                                            </div>
                                                            {% if ppElt.hasTime %}
                                                            <div style="display:inline-block; vertical-align: middle;">
                                                                    <div style="font-size:14px">{{ ppElt.value|localizeddate("medium", "none", null, null,'HH:mm') }}</div>
                                                                {% if not has2Date and endDate is not null and endDate.hasEndTime %}
                                                                    <div style="font-size:14px">{{ endDate.value|localizeddate("medium", "none", null, null,'HH:mm') }}</div>
                                                                {% endif %}
                                                                </div>
                                                        {% endif %}
                                                        {% else %}
                                                            <div>
                                                                <div style=" display:inline-block; width: 45px; font-style:italic">Début : </div> <div
                                                                        style=" display:inline-block;">{{ ppElt.value|localizeddate("medium", "none", null, null,'ccc dd MMM') }}{% if ppElt.hasTime %} {{ ppElt.value|localizeddate("medium", "none", null, null,'HH:mm') }}{% endif %}</div>
                                                            </div>
                                                            <div>
                                                                <div style=" display:inline-block; width:45px; font-style:italic">Fin : </div> <div
                                                                        style=" display:inline-block;">{{ endDate.value|localizeddate("medium", "none", null, null,'ccc dd MMM') }}{% if endDate.hasEndTime %} {{ endDate.value|localizeddate("medium", "none", null, null,'HH:mm') }}{% endif %}</div>
                                                            </div>
                                                        {% endif %}
                                                    </div>
                                                {% elseif not (ppElt.pollElement.type == constant('AppBundle\\Utils\\enum\\PollElementType::END_DATETIME')) %}
                                                    {{ ppElt.value }}
                                                    {% if not loop.first %}<br>{% endif %}
                                                {% endif %}
                                            {% endfor %}
                                        </span>
                                    </td>

                                    {% for moduleInvitation in moduleInvitations %}
                                        {% if moduleInvitation.eventInvitation.status is not constant('AppBundle\\Utils\\enum\\EventInvitationStatus::CANCELLED')
                                        and moduleInvitation.eventInvitation.status is not constant('AppBundle\\Utils\\enum\\EventInvitationStatus::AWAITING_VALIDATION') %}
                                            {% set pollProposalResponse = pollProposal.pollProposalResponsesOfModuleInvitation(moduleInvitation) %}
                                            {#{% if pollProposalResponse is not null %}#}
                                            <td class="response-column">
                                                {% if pollProposal.pollModule.votingType == constant('AppBundle\\Utils\\enum\\PollModuleVotingType::AMOUNT') %}
                                                    {% set responseToDisplay = pollProposalResponse is null or pollProposalResponse.answer is null ? 0 : pollProposalResponse.answer %}
                                                    {% if responseToDisplay > 0 %}
                                                        <span class="answer-thumb palette-Light-Green-100 bg strong">{{ responseToDisplay }}</span>
                                                    {% else %}
                                                        {{ responseToDisplay }}
                                                    {% endif %}
                                                {% elseif pollProposal.pollModule.votingType == constant('AppBundle\\Utils\\enum\\PollModuleVotingType::RANKING') %}
                                                    {% set responseToDisplay = pollProposalResponse is null or pollProposalResponse.answer is null ? 0 : pollProposalResponse.answer %}
                                                    {% if responseToDisplay > 0 %}
                                                        <span class="answer-thumb palette-Yellow-100 bg c-amber strong">{{ responseToDisplay }} <i class="zmdi zmdi-star"></i></span>
                                                    {% else %}
                                                        <span class="answer-thumb c-bluegray"> <i class="zmdi zmdi-star-half"></i> </span>
                                                        {#<span class="answer-thumb text palette-White c-bluegray"><i class="zmdi zmdi-help-outline zmdi-hc-fw"></i></span>#}
                                                    {% endif %}
                                                {% else %}
                                                    {% if pollProposalResponse is not null %}
                                                        {% if pollProposalResponse.answer == constant("AppBundle\\Utils\\enum\\PollProposalResponse::YES") %}
                                                            <span class="answer-thumb palette-Light-Green-100 bg c-lightgreen strong"><i class="zmdi zmdi-thumb-up"></i></span>
                                                        {% elseif pollProposalResponse.answer == constant("AppBundle\\Utils\\enum\\PollProposalResponse::MAYBE") %}
                                                            <span class="answer-thumb palette-Amber-100 bg c-amber strong"><i class="zmdi zmdi-thumb-up-down"></i></span>
                                                        {% elseif pollProposalResponse.answer == constant("AppBundle\\Utils\\enum\\PollProposalResponse::NO") %}
                                                            <span class="answer-thumb palette-Red-50 bg c-red strong"><i class="zmdi zmdi-thumb-down"></i></span>
                                                        {% else %}
                                                            <span class="answer-thumb c-bluegray"><i class="zmdi zmdi-help-outline zmdi-hc-fw"></i></span>
                                                        {% endif %}
                                                    {% else %}
                                                        <span class="answer-thumb c-bluegray"><i class="zmdi zmdi-help-outline"></i></span>
                                                    {% endif %}
                                                {% endif %}
                                            </td>
                                        {% endif %}
                                    {% endfor %}
                                </tr>
                            {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>