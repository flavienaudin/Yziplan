{# Données d'entrée :
- pollProposal (PollProposal) La proposition à afficher
- moduleInvitations ([ModuleInvitaion]) les invitations du module
#}

{% set numberOfResponse = 0 %}
{% set numberOfResponseYes = 0 %}
{% set numberOfResponseMaybe = 0 %}
{% set numberOfResponseNo = 0 %}

<div class="modal fade in" id="modalPollProposal{{ pollProposal.id }}" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true"><i class="zmdi zmdi-close"></i></span></button>
                {% for ppElt in pollProposal.pollProposalElements if ppElt.pollElement.type !=constant('AppBundle\\Utils\\enum\\PollElementType::PICTURE') %}
                    {% if not loop.first %}<br>{% endif %}
                    {% if ppElt.pollElement.type == constant('AppBundle\\Utils\\enum\\PollElementType::DATETIME') %}
                        {% set endDate = ppElt.pollProposal.getPollProposalEndDateElement %}
                        {% set has2Date = endDate is not null and endDate.hasEndDate and ppElt.value|localizeddate("medium", "none", null, null,'ddMMyyyy') != endDate.value|localizeddate("medium", "none", null, null,'ddMMyyyy') %}
                        <div>
                            {% if not has2Date %}
                                <div style="display:inline-block; vertical-align: middle;">
                                    <div style="font-size:12px; font-weight: bold; text-transform: capitalize;">{{ ppElt.value|localizeddate("medium", "none", null, null,'MMM') }}</div>
                                    <div style="font-size:10px; text-transform: uppercase;">{{ ppElt.value|localizeddate("medium", "none", null, null,"ccc") }}</div>
                                </div>
                                <div class="p-l-5 p-r-5" style="display:inline-block; font-size:22px; vertical-align: middle;">
                                    <strong>{{ ppElt.value|localizeddate("medium", "none", null, null,'dd') }}</strong>
                                </div>
                                {% if ppElt.hasTime %}
                                    <div style="display:inline-block; vertical-align: middle;">
                                        <div style="font-size:14px">{{ ppElt.value|localizeddate("medium", "none", null, null,'HH:mm') }}</div>
                                        {% if not has2Date and endDate is not null and endDate.hasEndTime %}
                                            <div style="font-size:14px">{{ endDate.value|localizeddate("medium", "none", null, null,'HH:mm') }}</div>
                                        {% endif %}
                                    </div>
                                {% endif %}
                            {% else %}
                                <div>
                                    <div style=" display:inline-block; width: 45px; font-style:italic">Début :</div>
                                    <div style=" display:inline-block;">{{ ppElt.value|localizeddate("medium", "none", null, null,'ccc dd MMM') }}{% if ppElt.hasTime %} {{ ppElt.value|localizeddate("medium", "none", null, null,'HH:mm') }}{% endif %}</div>
                                </div>
                                <div>
                                    <div style=" display:inline-block; width:45px; font-style:italic">Fin :</div>
                                    <div style=" display:inline-block;">{{ endDate.value|localizeddate("medium", "none", null, null,'ccc dd MMM') }}{% if endDate.hasEndTime %} {{ endDate.value|localizeddate("medium", "none", null, null,'HH:mm') }}{% endif %}</div>
                                </div>
                            {% endif %}
                        </div>
                    {% elseif not (ppElt.pollElement.type == constant('AppBundle\\Utils\\enum\\PollElementType::END_DATETIME')) %}
                        {% if ppElt.pollElement.type==constant('AppBundle\\Utils\\enum\\PollElementType::RICHTEXT') %}
                            {{ ppElt.value|raw }}
                        {% else %}
                            <h4 class="modal-title">{{ ppElt.value }}</h4>
                        {% endif %}
                    {% endif %}
                {% endfor %}
            </div>
            <div class="modal-body">
                <table class="table table-striped table-condensed">
                    <tbody>
                    {# Pour chaque réponse d'une proposition #}
                    {% for moduleInvitation in moduleInvitations %}
                        {% set guestPollProposalResponse = pollProposal.pollProposalResponsesOfModuleInvitation(moduleInvitation) %}
                        {% if guestPollProposalResponse is not null %}
                            <tr>
                                <td>
                                    <div class="avatar-img-container-sm center-block m-b-5">
                                        {{ include("@App/Avatar/partials/avatar_display.html.twig",{invitation : moduleInvitation}) }}
                                    </div>
                                </td>
                                <td>
                                    {{ moduleInvitation.displayableName(true, true) }}
                                </td>
                                <td>
                                    {% set numberOfResponse = numberOfResponse + 1 %}
                                    {% if guestPollProposalResponse.answer == constant("AppBundle\\Utils\\enum\\PollProposalResponse::YES") %}
                                        {% set numberOfResponseYes = numberOfResponseYes + 1 %}
                                        <span class="answer-thumb palette-Light-Green-100 bg c-lightgreen strong"><i class="zmdi zmdi-thumb-up"></i></span>
                                    {% elseif guestPollProposalResponse.answer == constant("AppBundle\\Utils\\enum\\PollProposalResponse::MAYBE") %}
                                        {% set numberOfResponseMaybe = numberOfResponseMaybe + 1 %}
                                        <span class="answer-thumb palette-Amber-100 bg c-amber strong"><i class="zmdi zmdi-thumb-up-down"></i></span>
                                    {% elseif guestPollProposalResponse.answer == constant("AppBundle\\Utils\\enum\\PollProposalResponse::NO") %}
                                        {% set numberOfResponseNo = numberOfResponseNo + 1 %}
                                        <span class="answer-thumb palette-Red-50 bg c-red strong"><i class="zmdi zmdi-thumb-down"></i></span>
                                    {% else %}
                                        <span class="answer-thumb c-bluegray"><i class="zmdi zmdi-help-outline zmdi-hc-fw"></i></span>
                                    {% endif %}
                                </td>
                            </tr>
                        {% endif %}
                    {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
{% set yesValue = numberOfResponse == 0 ? 0 : 100 * numberOfResponseYes / numberOfResponse %}
    {% set maybeValue = numberOfResponse == 0 ? 0 : 100 * numberOfResponseMaybe / numberOfResponse %}
    {% set noValue = numberOfResponse == 0 ? 0 : 100 * numberOfResponseNo / numberOfResponse %}
{% if numberOfResponse >0 %}
    <a data-toggle="modal" href="#modalPollProposal{{ pollProposal.id }}" class="">
        <div class="progress m-b-5">
            <div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="{{ yesValue }}" aria-valuemin="0" aria-valuemax="100" style="width:{{ yesValue }}%"></div>
        </div>
        <div class="progress m-b-5">
            <div class="progress-bar progress-bar-warning" role="progressbar" aria-valuenow="{{ maybeValue }}" aria-valuemin="0" aria-valuemax="100" style="width: {{ maybeValue }}%"></div>
        </div>
        <div class="progress m-b-5">
            <div class="progress-bar progress-bar-danger" role="progressbar" aria-valuenow="{{ noValue }}" aria-valuemin="0" aria-valuemax="100" style="width: {{ noValue }}%"></div>
        </div>
        {{ numberOfResponseYes + numberOfResponseMaybe + numberOfResponseNo }}&#8239;{{ "pollmodule.display.result.vote"|trans }}
    </a>
{% else %}
    <div class="progress m-b-5">
        <div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="{{ yesValue }}" aria-valuemin="0" aria-valuemax="100" style="width:{{ yesValue }}%"></div>
    </div>
    <div class="progress m-b-5">
        <div class="progress-bar progress-bar-warning" role="progressbar" aria-valuenow="{{ maybeValue }}" aria-valuemin="0" aria-valuemax="100" style="width: {{ maybeValue }}%"></div>
    </div>
    <div class="progress m-b-5">
        <div class="progress-bar progress-bar-danger" role="progressbar" aria-valuenow="{{ noValue }}" aria-valuemin="0" aria-valuemax="100" style="width: {{ noValue }}%"></div>
    </div>
    {{ numberOfResponseYes + numberOfResponseMaybe + numberOfResponseNo }}&#8239;{{ "pollmodule.display.result.vote"|trans }}
{% endif %}
