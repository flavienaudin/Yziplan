<script src="https://apis.google.com/js/client.js"></script>
<script>
    var GMAIL_CONTACTS = new Array();

    function authClick() {
// Your Client ID is retrieved from your project
//in the Developer Console => https://console.developers.google.com
        var CLIENT_ID = '97577591330-rnga2ufsqktnn69e8urbupu12rcc889e.apps.googleusercontent.com';
        var SCOPES = ["https://www.googleapis.com/auth/contacts.readonly"];

        gapi.auth.authorize(
                {client_id: CLIENT_ID, scope: SCOPES, immediate: false}, authResult);

        return false;
    }

    /**
     * Handle response from authorization server.
     * @param {Object} authResult Authorization result.
     */
    function authResult(_Result) {
        var _Div = document.getElementById('divauthresult');
        if (_Result && !_Result.error) {
            // Auth OK! => load API.
            _Div.style.display = 'none';
            loadPeopleApi();
        } else {
            // Auth Error, allowing the user to initiate authorization by
            _Div.innerText = ':( Authtentication Error : ' + _Result.error;
        }
    }

    /**
     * Load Google People client library. List Contact requested info
     */
    function loadPeopleApi() {
        gapi.client.load('https://people.googleapis.com/$discovery/rest',
                'v1',
                displayContacts);
    }

    function displayContacts() {
        /**
         * [id][[photo][displayName][email]]
         */
        loadContacts(null);

    }

    function loadContacts(pageToken) {
        var request = null;
        if (pageToken != null) {
            request = gapi.client.people.people.connections.list({
                'pageToken': "'" + pageToken + "'",
                'resourceName': 'people/me',
                'pageSize': 50,
                'sortOrder': 'FIRST_NAME_ASCENDING',
                'requestMask.includeField': 'person.photos,person.email_addresses,person.names'
            });
        } else {
            request = gapi.client.people.people.connections.list({
                'resourceName': 'people/me',
                'pageSize': 50,
                'sortOrder': 'FIRST_NAME_ASCENDING',
                'requestMask.includeField': 'person.photos,person.email_addresses,person.names'
            });
        }

        request.execute(function (resp) {
            var connections = resp.connections;

            if (connections != null && connections.length > 0) {
                for (i = 0; i < connections.length; i++) {
                    var person = connections[i];
                    if (person.emailAddresses && person.emailAddresses.length > 0) {
                        var contact = new Array();
                        if (person.photos && person.photos.length > 0)
                            contact.push(person.photos[0].url);
                        else
                            contact.push(null);

                        if (person.names && person.names.length > 0)
                            contact.push(person.names[0].displayName);
                        else
                            contact.push('');

                        contact.push(person.emailAddresses[0].value);
                        GMAIL_CONTACTS.push(contact);
                    }
                }
            }
            if (resp.nextPageToken != null) {
                loadContacts(resp.nextPageToken)
            } else {
                showContacts();
            }
        });
    }

    /**
     * Show Contacts Details display on a table pagesize = 100 connections.
     */
    function showContacts() {
        if (GMAIL_CONTACTS.length > 0) {
            var _Html = "<table><tr><th>Photos</th><th>Name</th><th>Email</th></tr>";
            var _EmptyCell = "<td> - </td>";

            for (i = 0; i < GMAIL_CONTACTS.length; i++) {
                var person = GMAIL_CONTACTS[i];
                _Html += "<tr>";

                if (person[0] != null)
                    _Html += "<td><div class='avatar-img-container-sm center-block'><img class='yzi-avatar-img' src='" + person[0] + "'></div></td>";
                else
                    _Html += _EmptyCell;

                _Html += "<td>" + person[1] + "</td>";

                _Html += "<td>" + person[2] + "</td>";

                _Html += "</tr>";
            }
            _Html += "</table>";
            divtableresult.innerHTML = "Contacts found : <br>" + _Html;
        } else {
            divtableresult.innerHTML = "";
            divauthresult.innerText = "No Contacts found!";
        }
    }
</script>
<h3>Get your contacts using People API</h3>
<p>
    Press button to Authorize and Download your Contacts in JSON
    <br/>
    <br/>
    <button onclick="authClick(event)">Load Contacts</button>
</p>
<div id="divauthresult"></div>
<div id="divtableresult"></div>